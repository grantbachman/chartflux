<html>
	<head>
		{% if title %}
		<title>{{ title }}</title>
		{% else %}
		<title>Welcome to Chartflux!</title>
		{% endif %}
		<script type="text/javascript" src="{{ url_for('static', filename='d3.v3.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='d3.legend.js') }}"></script>
		<style>

	  .axis path { fill: none; stroke: black; }  /* border */
		.xgrid,.ygrid path { fill: none; stroke: black; }

		.axis line { fill: none; stroke: black; }  /* tick marks */
		.xgrid,.ygrid line { fill: none; stroke: #eeeeee; }

		.line { fill: none;
						stroke: steelblue;
						stroke-width: 1.5px;
		}

		.legend rect {
		  fill:white;
		  stroke:black;
		  opacity:0.8;
		}

		</style>
	</head>
	<body>
		<b>{{ stock.name }}</b><br />
		From: {{ stock.start }}<br />
		To: {{ stock.end }}<br />
		<br />
	</body>

		<script type="text/javascript">
		var margin = {top: 20, bottom: 50, left: 50, right: 20}
		var svgWidth = 700 - margin.left - margin.right;
		var svgHeight = 500 - margin.top - margin.bottom;
		var parseDate = d3.time.format.iso.parse;

		var dataset = JSON.parse('{{ data }}');

		var minDate = parseDate(dataset[0]['Date']);
		var maxDate = parseDate(dataset[dataset.length - 1]['Date']);
		var minPrice = d3.min(dataset, function(obj) { return obj['Adj Close']; });
		var maxPrice = d3.max(dataset, function(obj) { return obj['Adj Close']; });

		var xScale = d3.time.scale()
												.domain([minDate,maxDate])
									      .range([0, svgWidth])
		var yScale = d3.scale.linear()
												.domain([minPrice, maxPrice])
												.range([svgHeight, 0])
												.nice();

		var xAxis = d3.svg.axis()
											.scale(xScale)
											.orient("bottom")

		var yAxis = d3.svg.axis().scale(yScale).orient("left");

		var svg = d3.select("body").append("svg")
								.attr("width", svgWidth + margin.left + margin.right)
								.attr("height", svgHeight + margin.left + margin.bottom)
				  			.append("g")
							  .attr("transform", "translate(" + margin.left + ","
																							  + margin.right + ")")

		var line = d3.svg.line()
				.x(function(d) { return xScale(parseDate(d['Date'])); })
				.y(function(d) { return yScale(d['Adj Close']); })
				.interpolate("linear");


		svg.append("g")
			 .attr("class", "x axis")
			 .attr("transform", "translate(0," + svgHeight + ")")
			 .call(xAxis)
			 .selectAll("text")
			 .style("text-anchor", "end")
			 .attr("transform", "rotate(-65)")

		svg.append("g")
			 .attr("class", "y axis")
			 .call(yAxis)
			 .append("text").attr("text-anchor","end")
											.attr("dy", "1em")
											.attr("transform", "rotate(-90)")
											.text("Price ($)");

		var xGrid = svg.append("g")
			 .attr("class", "xgrid")
			 .call(xAxis.tickSize(svgHeight,0,0).tickFormat(""));

		var yGrid = svg.append("g")
			 .attr("class", "ygrid")
			 .call(yAxis.tickSize(-svgWidth,0,0).tickFormat(""));

		// Hide the first grid line on each axis.
		// They were covering up the axis lines
		xGrid.select(".tick").attr("visibility", "hidden");
		yGrid.select(".tick").attr("visibility", "hidden");

		var lineGraph = svg.append("path")
											 .attr("class", "line")
										   .attr("data-legend", '{{ stock.ticker }}')
											 .attr("d", line(dataset))

		svg.append("g").attr("class", "legend").attr("transform", "translate(50,30)").call(d3.legend)

		</script>
</html>
